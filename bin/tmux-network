#!/bin/bash

. "$DOTPATH"/etc/lib/util.zsh

if is_cygwin; then
    wlan_status=`netsh wlan show interfaces | sed -e '/^\s*$/d'`

    if echo "$wlan_status" | grep -vq 'not running'; then
        network_info=`echo "$wlan_status" | sed -e 's/\s//g'`

        state=`echo "$network_info" | grep "State" | awk -F : '{print $2}'`
        ssid=`echo "$network_info" | grep "SSID" | awk -F : '{print $2}'`
        signal=`echo "$network_info" | grep "Signal" | awk -F : '{print $2}'`

        case "${state}" in
            "connected")
                signals=(▁ ▃ ▄ ▆ █)
                signal_icon=""
                if has bc; then
                    signal_=`echo "scale=1; ${signal%\%} / 100.0 * 5 + 1" | bc`

                    for ((i=0; i < ${signal_%.*}; i++ )); do
                        signal_icon="${signal_icon}${signals[$i]}"
                    done
                else
                    signal_icon="?"
                fi
                network_status="${signal_icon} #[bg=colour027,fg=white] ${ssid} #[bg=default,fg=default]"
                ;;
            "disconnected")
                network_status="#[fg=red] ✘ #[default] #[bg=colour027,fg=white] DISCONNECTED #[bg=default,fg=default]"
                ;;
            *)
                network_status="#[fg=yellow] ... #[default]"
                ;;
        esac
    fi

    echo "${network_status}"
fi
